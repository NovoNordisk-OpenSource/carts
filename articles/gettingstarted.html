<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started • carts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">carts</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gettingstarted.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/param.html">Parametrization of the negative binomial and gamma distribution</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NovoNordisk-OpenSource/carts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started</h1>
                        <h4 data-toc-skip class="author">Klaus K. Holst
and Benedikt Sommer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NovoNordisk-OpenSource/carts/blob/main/vignettes/gettingstarted.Rmd" class="external-link"><code>vignettes/gettingstarted.Rmd</code></a></small>
      <div class="d-none name"><code>gettingstarted.Rmd</code></div>
    </div>

    
    
<!-- tufte::tufte_html: default -->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>carts</code> package is a clinical trial simulation tool
for power and sample size estimation. A modular, building-block design
allows the simulation of many common clinical trial designs with only a
few lines of code. In addition, the package provides a range of
estimators for continuous, count and survival endpoints. This vignette
introduces the basic functionalities of the <code>carts</code> package
and aims to familarize the reader with the package interface. The
centerpiece of the interface is the <a href="https://r6.r-lib.org/" class="external-link">R6
reference class</a> <code>Trial</code>, with the constructor and main
methods visualized in Figure 1. To this end, we will consider a
two-armed parallel trial design to introduce the <code>Trial</code>
class and demonstrate how power and sample size estimation are carried
out conveniently.</p>
<div class="float">
<img src="figs/trial-class.png" style="width:100.0%" alt="The ‘Trial’ R6 reference class. The blue boxes define the arguments to the constructor, and the red boxes the most important class methods."><div class="figcaption">The ‘Trial’ R6 reference class. The blue boxes
define the arguments to the constructor, and the red boxes the most
important class methods.</div>
</div>
</div>
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<div class="section level3">
<h3 id="setting-up-parallel-computations">Setting up parallel computations<a class="anchor" aria-label="anchor" href="#setting-up-parallel-computations"></a>
</h3>
<p>The <code>carts</code> package is basing its power and sample size
estimation on Monte Carlo integration techniques. To deal with the
computationally intensive procedures, the package uses extensive
parallel computations based on the <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package. To
enable this, all that needs to be done is to define the desired parallel
backend, i.e.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multicore.html" class="external-link">multicore</a></span><span class="op">)</span></span></code></pre></div>
<p>This enables parallelization on all available cores on the current
machine. It is equally straight-forward to set up a parallel batch
computations on a cluster (see for example <a href="https://cran.r-project.org/package=future.batchtools" class="external-link">future.batchtools</a>).</p>
</div>
<div class="section level3">
<h3 id="progress-bars-and-logging-information">Progress bars and logging information<a class="anchor" aria-label="anchor" href="#progress-bars-and-logging-information"></a>
</h3>
<p>As some calculations can be time-consuming we recommend enabling
progress-bars, which can be achieved with the following code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span>global <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">handlers</a></span><span class="op">(</span><span class="fu">progressr</span><span class="fu">::</span><span class="fu"><a href="https://progressr.futureverse.org/reference/handler_progress.html" class="external-link">handler_progress</a></span><span class="op">(</span>times <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We refer to the <a href="https://cran.r-project.org/package=progressr/vignettes/progressr-01-intro.html" class="external-link">progressr
vignette</a> for information on how to customize the progress bar
appeareance.</p>
<p>Most output in the <code>carts</code> package is handled by the <a href="https://daroczig.github.io/logger/" class="external-link">logger</a> logging utility. We
refer to the following <a href="https://daroczig.github.io/logger/articles/customize_logger.html" class="external-link">article</a>
for information on how to alter the logging level and how to change the
destination of the log records, which can be useful when running the
<code>carts</code> package as batch jobs on a cluster.</p>
</div>
<div class="section level3">
<h3 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a>
</h3>
<p>It is sufficient to use a top-level seed for reproducibility of
simulations when the future package is used for parallelization on a
local machine. Additional care must be taken for distributed
computations on a compute cluster.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://novonordisk-opensource.github.io/carts/">"carts"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="two-armed-parallel-design">Two-armed parallel design<a class="anchor" aria-label="anchor" href="#two-armed-parallel-design"></a>
</h2>
<p>We will consider a two-armed parallel design where the outcome of
interest is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Y</mi><mo>∣</mo><mi>W</mi><mo>,</mo><mi>A</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mi>w</mi></msub><mi>W</mi><mo>+</mo><msub><mi>β</mi><mi>a</mi></msub><mi>A</mi><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
Y \mid W, A \sim N(\beta_0 + \beta_w W + \beta_a A, \sigma^2)
\end{align*}</annotation></semantics></math> with treatment variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∼</mo><mi>B</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>o</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">A\sim Bernoulli(0.5)</annotation></semantics></math>
which is independent of the baseline covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">W \sim N(0, 1)</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="trial-model">Trial model<a class="anchor" aria-label="anchor" href="#trial-model"></a>
</h3>
<p>To simulate this trial we first define the random number generators
for treatment indicator
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
and baseline covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">p.a</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="va">p.a</span><span class="op">)</span>,</span>
<span>    w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>which in the context of <code>carts</code> is a covariate model. The
general rule for simulating trial designs with time-invariant outcomes,
i.e. outcomes that are only a function of information that is available
at baseline/randomization, is that the covariate model is a function
with first argument <code>n</code> (sample size) that returns covariate
data in tabulated form, either as a <code>data.frame</code> or
<code>data.table</code>. Additional parameters of the covariate model
can be added after the sample size argument <code>n</code>, being here
the treatment probability <code>p.a</code>.</p>
<p>The trial model for this design is completed with the help of
<code>outcome_continuous</code>. This built-in function generates
continuous outcomes from tabulated baseline covariates, i.e. the output
of the covariate model. The default arguments of built-in functions can
be updated conveniently with <code>setargs</code> to the desired
parameters of the trial. Simulating the trial
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Y</mi><mo>∣</mo><mi>W</mi><mo>,</mo><mi>A</mi><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>10</mn><mo>−</mo><mn>0.5</mn><mi>A</mi><mo>−</mo><mn>1.2</mn><mi>W</mi><mo>,</mo><mn>1.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
Y \mid W, A \sim N(10 - 0.5 A - 1.2 W , 1.5)
\end{align*}</annotation></semantics></math> requires to update the
default arguments of <code>outcome_continuous</code> as</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setargs.html">setargs</a></span><span class="op">(</span></span>
<span>  <span class="va">outcome_continuous</span>,</span>
<span>  mean <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">w</span>,</span>
<span>  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">1.2</span><span class="op">)</span>, <span class="co"># coef order as defined by the above formula</span></span>
<span>  sd <span class="op">=</span> <span class="fl">1.5</span> <span class="op">**</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Finally, we instantiate a model object from the R6 <code>Trial</code>
class</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Trial.html">Trial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  covariates <span class="op">=</span> <span class="va">covariate</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>  exclusion <span class="op">=</span> <span class="va">identity</span>, <span class="co"># no exclusion criteria (default)</span></span>
<span>  info <span class="op">=</span> <span class="st">"Two-armed parallel design"</span> <span class="co"># optional info</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>where, by default, no exclusion model is used.</p>
</div>
<div class="section level3">
<h3 id="trial-simulation">Trial simulation<a class="anchor" aria-label="anchor" href="#trial-simulation"></a>
</h3>
<p>Simulating data from the defined model object is done via the
simulate method</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1e4</span><span class="op">)</span></span></code></pre></div>
<p>The method is a wrapper calling <code>carts:::trial_simulate</code>
which combines sampling data from the covariate and outcome model, and
the application of the exclusion model in an iterative process. First
<code>n</code> subjects are sampled from the covariate model. The
sampled tabulated data is then converted into a <code>data.table</code>
and passed on to the outcome model. The sampled covariate and outcome
data are then passed together as a single <code>data.table</code> to the
exclusion model. Thus, the exclusion model allows for removing subjects
based on both the covariate and outcome data. If subjects are removed,
the remaining subjects are stored and the next iteration begins by
sampling from the covariate model. The process repeats until a total of
<code>n</code> subjects have been sampled.</p>
<p>Without additional arguments, the method uses the assigned default
arguments of the covariate and outcome model to generate the sample.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dd</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    0    1 </span></span>
<span><span class="co">## 5001 4999</span></span></code></pre></div>
<p>Inspecting the simulated data</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">##       id     a          w   num        y</span></span>
<span><span class="co">##    &lt;num&gt; &lt;int&gt;      &lt;num&gt; &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1:     1     1 0.07122244     0 8.165036</span></span>
<span><span class="co">## 2:     2     1 0.97029003     0 7.411990</span></span></code></pre></div>
<p>reveals that the package adds subject (<code>id</code>) and period
(<code>num</code>) identifiers to the output of the method. This is the
default behaviour that provides the functionality to follow subjects
across multiple periods in within-subject trial designs.</p>
<div class="section level4">
<h4 id="updating-model-parameters">Updating model parameters<a class="anchor" aria-label="anchor" href="#updating-model-parameters"></a>
</h4>
<p>Additional arguments are accepted by the simulate method that allow
for simulating from the same trial object while varying model
parameters. This circumvents the instantiation of a new model object and
provides an elegant way to carry out parameter sensitivity analyses or
interactively use a trial model</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1e4</span>, p.a <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">$</span><span class="va">a</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    0    1 </span></span>
<span><span class="co">## 1017 8983</span></span></code></pre></div>
<p>In fact, most public methods of the <code>Trial</code> class allow
passing arguments to the underlying covariate, outcome and exclusion
models via the optional argument of the <code>Trial</code> method.</p>
<div class="section level5">
<h5 id="safeguarding-parameter-clashes">Safeguarding parameter clashes<a class="anchor" aria-label="anchor" href="#safeguarding-parameter-clashes"></a>
</h5>
<p>The simulate method passes all defined model parameters internally to
the covariate, outcome and exclusion models. For the given example this
means that each of the model component function calls receive
<code>p.a = 0.9</code> as an optional argument. This enables updating
shared parameters in all model components with a single value</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial0</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Trial.html">Trial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  covariates <span class="op">=</span> <span class="va">covariate</span>,</span>
<span>  outcome <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">p.a</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">p.a</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trial0</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">1e4</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">##         y      a</span></span>
<span><span class="co">##     &lt;num&gt;  &lt;num&gt;</span></span>
<span><span class="co">## 1: 0.1009 0.4876</span></span>
<span><span class="va">trial0</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">1e4</span>, p.a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">##        y     a</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1     1</span></span></code></pre></div>
<p>but also opens a pathway to accidentally overwriting default
parameters of built-in functions. A simple solution for preventing this
is achieved by using functional wrappers. This is shown here for the
covariate model, where the default value of <code>p.a</code> cannot be
changed dynamically anymore.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial0</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Trial.html">Trial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  covariates <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu">covariate</span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>  outcome <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">p.a</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">p.a</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trial0</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">1e4</span>, p.a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">##        y      a</span></span>
<span><span class="co">##    &lt;num&gt;  &lt;num&gt;</span></span>
<span><span class="co">## 1:     1 0.4926</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="updating-default-parameters-of-a-trial-model">Updating default parameters of a trial model<a class="anchor" aria-label="anchor" href="#updating-default-parameters-of-a-trial-model"></a>
</h5>
<p>The <code>Trial</code> class also allows to set and update default
arguments of covariate, outcome and exclusion models. Another way to
utilise built-in functions is therefore to initialize a trial object
as</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Trial.html">Trial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  covariates <span class="op">=</span> <span class="va">covariate</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">outcome_continuous</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>and then set default values for the outcome model with</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">args_model</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">w</span>,</span>
<span>  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using the <code>args_model</code> method updates the
<code>model.args</code> attribute of the trial object, which are then
used internally as the default option to simulate the trial data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">1e4</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"a"</span><span class="op">]</span></span>
<span><span class="co">##        a         y</span></span>
<span><span class="co">##    &lt;int&gt;     &lt;num&gt;</span></span>
<span><span class="co">## 1:     0 10.037275</span></span>
<span><span class="co">## 2:     1  9.515117</span></span></code></pre></div>
<p>However, the parameters in <code>trial$model.args</code> are
overruled when parameters with matching names are passed to the simulate
method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">1e4</span>, par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"a"</span><span class="op">]</span></span>
<span><span class="co">##        a           y</span></span>
<span><span class="co">##    &lt;int&gt;       &lt;num&gt;</span></span>
<span><span class="co">## 1:     1 19.99394634</span></span>
<span><span class="co">## 2:     0 -0.01365177</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="estimators">Estimators<a class="anchor" aria-label="anchor" href="#estimators"></a>
</h3>
<p>The <code>carts</code> package provides a range of estimators for
various trial designs. All built-in estimators are function generators
that return an estimator, which is a function of data (first input
argument). To be compatible with the package design, each estimator must
return a named vector that includes the estimate (Estimate) and standard
errors (“Std.Err”). The returned vector may include additional elements
as they not interfere with any internal procedures. A crude (marginal)
estimator can be defined by using <code>est_glm</code>, which is a
function generator</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_glm.html">est_glm</a></span><span class="op">(</span></span>
<span>  response <span class="op">=</span> <span class="st">"y"</span>, <span class="co"># default value</span></span>
<span>  treatment <span class="op">=</span> <span class="st">"a"</span> <span class="co"># default value</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">trial</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="fu">estimator</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">##   Estimate Std.Err    2.5%   97.5%  P-value</span></span>
<span><span class="co">## a  -0.5394  0.1918 -0.9153 -0.1635 0.004914</span></span></code></pre></div>
<p>Estimators can be assigned to a trial object either during its
initialization via the <code>estimators</code> argument of
<code>Trial$new</code> or after initialization</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">estimators</span><span class="op">(</span>marginal <span class="op">=</span> <span class="fu"><a href="../reference/est_glm.html">est_glm</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># using def. args. of est_glm</span></span></code></pre></div>
<p>and all assigned estimators can be retrieved by calling the estimator
method</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trial</span><span class="op">$</span><span class="fu">estimators</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] "marginal"</span></span></code></pre></div>
<p>or printing the trial object</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trial</span><span class="op">)</span></span>
<span><span class="co">## ── Trial Object ── </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model arguments:  </span></span>
<span><span class="co">##  • mean: Class 'formula'  language ~1 + a + w</span></span>
<span><span class="co">##  • par:  num [1:3] 10 -0.5 -1.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary arguments:  </span></span>
<span><span class="co">##  • level:  num 0.05</span></span>
<span><span class="co">##  • null:  num 0</span></span>
<span><span class="co">##  • ni.margin:  NULL</span></span>
<span><span class="co">##  • alternative:  chr "!="</span></span>
<span><span class="co">##  • reject.function:  NULL</span></span>
<span><span class="co">##  • true.value:  NULL</span></span>
<span><span class="co">##  • nominal.coverage:  num 0.9</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Covariates:</span></span>
<span><span class="co">##  function (n, p.a = 0.5, ...)   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome:</span></span>
<span><span class="co">##  function (data, mean = NULL, par = NULL, sd = 1, het = 0, outcome.name = "y",      remove = c("id", "num"), family = gaussian(), ...)   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exclusion:</span></span>
<span><span class="co">##  function (x, ...)   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimators:</span></span>
<span><span class="co">##   1. marginal </span></span>
<span><span class="co">## ────────────────────</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="power-estimation">Power estimation<a class="anchor" aria-label="anchor" href="#power-estimation"></a>
</h3>
<p>Carrying out power estimations is straightforward once estimators are
assigned to the trial model.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">estimate_power</span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">300</span>, <span class="co"># sample size</span></span>
<span>  R <span class="op">=</span> <span class="fl">500</span> <span class="co"># number of Monte Carlo replicates</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## [1] 0.778</span></span></code></pre></div>
<div class="section level4">
<h4 id="hypothesis-testing">Hypothesis testing<a class="anchor" aria-label="anchor" href="#hypothesis-testing"></a>
</h4>
<p>The method uses <code>carts:::summary.runtrials</code> internally to
implement the hypothesis test for a given trial design. By default, a
two-sided test is carried out for the null hypothesis of no treatment
effect with 0.05 signifcance level. The test can be changed via the
<code>summary.args</code> argument</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">estimate_power</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span>, R <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  summary.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternative <span class="op">=</span> <span class="st">"&gt;"</span><span class="op">)</span> <span class="co"># one-sided test should</span></span>
<span>  <span class="co"># have no power as a &lt; 0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## [1] 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="updating-model-parameters-1">Updating model parameters<a class="anchor" aria-label="anchor" href="#updating-model-parameters-1"></a>
</h4>
<p>Arguments to the covariate, outcome and exclusion models can be
passed via the optional arguments of the method. The behavior is
identical to the one of <code>Trial$simulate</code>. That is, passed
arguments overwrite their default values in
<code>Trial$model.args</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">estimate_power</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span>, R <span class="op">=</span> <span class="fl">500</span>, p.a <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.376</span></span></code></pre></div>
<p>One should note that the current interface does not pass on these
optional arguments to estimators. As a consequence, all estimators must
be initialized with values assigned to their optional arguments.</p>
</div>
<div class="section level4">
<h4 id="multiple-estimators">Multiple estimators<a class="anchor" aria-label="anchor" href="#multiple-estimators"></a>
</h4>
<p>The default settings of <code>carts</code> is to estimate the power
of all estimators that are defined in <code>Trial$estimators</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trial</span><span class="op">$</span><span class="fu">estimators</span><span class="op">(</span>adjusted <span class="op">=</span> <span class="fu"><a href="../reference/est_glm.html">est_glm</a></span><span class="op">(</span>covariates <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trial</span><span class="op">$</span><span class="fu">estimate_power</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span>, R <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="co">## marginal adjusted </span></span>
<span><span class="co">##    0.792    0.992</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="sample-size-estimations">Sample-size estimations<a class="anchor" aria-label="anchor" href="#sample-size-estimations"></a>
</h3>
<p>Last, we estimate the sample size required to attain 90% power for
the specified trial model and estimator</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># trial$estimate_samplesize(</span></span>
<span><span class="co">#   power = 0.9, # default</span></span>
<span><span class="co">#   estimator = trial$estimators("adjusted")</span></span>
<span><span class="co"># )</span></span></code></pre></div>
<p>The method optimizes the sample size by internally calling the
<code>Trial$estimate_power</code> method. Therefore, the behavior for
updating model parameters and changing the default settings for the
hypothesis test are identical. That is, model parameters are passed as
optional arguments or set via the <code>args_model</code> method, and
the <code>summary.args</code> argument is used to change the hypothesis
test.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benedikt Sommer, Klaus K. Holst, Foroogh Shamsi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
